services:
  dyad:
    build: .
    environment:
      DYAD_WEB_MODE: "true"
      DYAD_WEB_HOST: "0.0.0.0"
      DYAD_WEB_PORT: "${DYAD_WEB_PORT:-4000}"
      DYAD_DATA_PATH: "/data/dyad"
      DYAD_PUBLIC_HOST: "${DYAD_PUBLIC_HOST:-localhost}"
      DYAD_SERVER_HOSTNAME: "${DYAD_SERVER_HOSTNAME:-localhost}"
      DYAD_PROXY_LISTEN_HOST: "0.0.0.0"
      DYAD_PROXY_PORT_MIN: "${DYAD_PROXY_PORT_MIN:-50000}"
      DYAD_PROXY_PORT_MAX: "${DYAD_PROXY_PORT_MAX:-50100}"
      DYAD_USE_NPM: "true"
      NODE_ENV: "production"
      NODE_OPTIONS: "${NODE_OPTIONS:---max-old-space-size=4096}"
    volumes:
      - "${DYAD_HOST_DATA_PATH:-./dyad-data}:/data/dyad"
    ports:
      - "${DYAD_WEB_PORT:-4000}:${DYAD_WEB_PORT:-4000}"
      - "${DYAD_PROXY_PORT_MIN:-50000}-${DYAD_PROXY_PORT_MAX:-50100}:${DYAD_PROXY_PORT_MIN:-50000}-${DYAD_PROXY_PORT_MAX:-50100}"
